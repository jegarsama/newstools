<?php#region License Statement	// Copyright (c) SeniorPartners. All rights reserved.	//	// 클래스명	: BasePage	// 경로		: [www]/_include/class/	// 코드		: ANSI	// 설명		: 기본 페이지 출력 클래스	// 작성자	: 최진원 (jw.choi@yourstage.com)	// 소속명	: Development Team	// 수정일	: 20090424#endregionif( !class_exists("BBSPage") ){	global $gcls_ClassCollection;	$gcls_ClassCollection->LoadClassDefine( "/class/pages", "BasePage" );	$gcls_ClassCollection->LoadClassDefine( "/class/data", "EZ_BBS", GDC_INC_ROOT );	$gcls_ClassCollection->LoadClassDefine( "/data", "Paging", GDC_SYSTEM_ROOT );	class BBSPage extends BasePage	{		var $cls_EZ_BBSControl	= null;	//게시판 관리용 클래스		var $cls_Paging			= null;	//Paging 처리 클래스		var $ListPageName		= Array();	//Page Name List		//클래스 생성자		function BBSPage()		{			$this->InitField();		}		#region 상속받은 메소드 보완			/**			* 데이터 초기화			*			*/			function InitField()			{				parent::InitField();				$this->cls_EZ_BBSControl = new EZ_BBS();				$this->cls_Paging = new Paging();			}			/**			* DBA 셋팅			*			* @param class		$acls_DBA				:	DBA 클래스			*/			function SetDBA( $acls_DBA )			{				parent::SetDBA( $acls_DBA );				$this->cls_EZ_BBSControl->SetDBA( $acls_DBA );			}		#endregion		#region BBS 목록 데이터 관리			/**			* List 관리용 변수 설정			*			* @param string		$as_Condition			:	쿼리 조건부			* @param string		$as_Orderby				:	정렬순서			* @param integer	$ai_RecordCntPerPage	:	페이지당 레코드 수			* @param integer	$ai_PageCntPerBlock		:	블럭당 페이지 수			*/			function LoadListInfoOfBBSInfo( $as_Condition="", $as_Orderby="", $ai_RecordCntPerPage=20, $ai_PageCntPerBlock=5 )			{				$ii_page = $this->GetRequest( "page", 1, true );				$ii_page = ($ii_page < 1) ? 1 : $ii_page;				$this->SetListInfoFieldOfBBSInfo( "page", $ii_page );				$this->SetListInfoFieldOfBBSInfo( "RecordCntPerPage", $ai_RecordCntPerPage );				$this->SetListInfoFieldOfBBSInfo( "PageCntPerBlock", $ai_PageCntPerBlock );				//$this->SetListInfoFieldOfBBSInfo( "PageQuery", "" );				//$this->SetListInfoFieldOfBBSInfo( "SearchSet", "" );				//$this->SetListInfoFieldOfBBSInfo( "LinkOption", "" );				$this->SetListInfoFieldOfBBSInfo( "Addwhere", $as_Condition );				//$this->SetListInfoFieldOfBBSInfo( "SpecialTop", 0 );				$this->ReSetListInfoOfBBSInfo( $as_Orderby );			}			/**			* List 관리용 변수 재계산			*			* @param string		$as_Orderby				:	정렬순서			*/			function ReSetListInfoOfBBSInfo( $as_Orderby="" )			{				$this->cls_EZ_BBSControl->ReSetListInfo( "ez_bbsinfo", $as_Orderby );			}			/**			* List 관리용 변수 필드 셋팅			*			* @param string		$as_FieldName			:	필드명			* @param string		$as_Data				:	데이터			*/			function SetListInfoFieldOfBBSInfo( $as_FieldName, $as_Data )			{				$this->cls_EZ_BBSControl->SetListInfoField( "ez_bbsinfo", $as_FieldName, $as_Data );			}			/**			* List 관리용 변수 필드 설정값 획득			*			* @param string		$as_FieldName			:	필드명			* @return string/integer			*/			function GetListInfoFieldOfBBSInfo( $as_FieldName )			{				return $this->cls_EZ_BBSControl->GetListInfoField( "ez_bbsinfo", $as_FieldName );			}			/**			* List 관리용 변수 필드 설정 반환			*			* @return array			*/			function GetListInfoOfBBSInfo()			{				return $this->cls_EZ_BBSControl->GetListInfo( "ez_bbsinfo" );			}		#endregion		#region BBS 목록 관리			/**			* 게시판 조회			*			* @return recordset			*/			function GetSelectRecordsOfBBSInfo()			{				return $this->cls_EZ_BBSControl->GetSelectRecords( "ez_bbsinfo", $this->GetListInfoFieldOfBBSInfo( "Addwhere" ), $this->GetListInfoFieldOfBBSInfo( "Orderby" ) );			}			/**			* 레코드 루프적용			*			* @param recordset	$ars_Source				:	데이터 원본 레코드셋			* @param array		$arr_Fields				:	데이터 셋팅적용 필드배열			* @return boolean			*/			function LoopForBBSInfo( $ars_Source, $arr_Fields=null )			{				return $this->cls_EZ_BBSControl->Loop( "ez_bbsinfo", $ars_Source, $arr_Fields );			}			/**			* 회원레벨명 반환			*			* @param string		$as_Level			:	구분코드			* @param string		$as_FieldName			:	필드명			* @return string			*/			function GetOptionOfUserLevel( $as_Level, $as_FieldName )			{				$is_rtn = "<option value=\"".$as_Level."\"";				if( $as_Level == "ZM" )				{					$is_rtn.= (($this->cls_EZ_BBSControl->GetData( "ez_bbsinfo", $as_FieldName )=="ZM") || ($this->cls_EZ_BBSControl->GetData( "ez_bbsinfo", $as_FieldName )=="")) ? " selected" : "";				}				else				{					$is_rtn.= ($as_Level == $this->cls_EZ_BBSControl->GetData( "ez_bbsinfo", $as_FieldName )) ? " selected" : "";				}				$is_rtn.= ">".$this->UserLevel( $as_Level )."</option>";				return $is_rtn;			}			/**			* IsAllowedAction			*			* @param string		$as_FieldName			:	필드명			* @param string		$as_Level				:	권한코드			* @param boolean	$ab_Default				:	기본 반환 값			* @return boolean			*/			function IsAllowedAction( $as_FieldName, $as_Level='', $ab_Default=false )			{				$ib_Permi	= $this->cls_EZ_BBSControl->GetData( "ez_bbsinfo", $as_FieldName );				if( empty($ib_Permi) )	return $ab_Default;	//설정값이 없는 항목인 경우				if( empty($as_Level) )	$as_Level = 'ZM';				$ib_rtn = ($as_Level <= $ib_Permi) ? true : false;				return $ib_rtn;			}		#endregion		#region BBS 목록 페이징 출력			/**			* 페이징 처리			*			* @param boolean	$ab_pniView				:	이전/다음블럭 링크 출력여부			* @param string		$as_peIcon				:	처음블럭 링크 아이콘			* @param string		$as_pIcon				:	이전블럭 링크 아이콘			* @param string		$as_nIcon				:	다음블럭 링크 아이콘			* @param string		$as_neIcon				:	마지막블럭 링크 아이콘			* @param string		$as_FileLink			:	링크되는 페이지명			* @param string		$as_IndexName			:	페이지 번호 변수명			* @return string			*/			function PrintPageLinkOfBBSInfo( $ab_pniView='none', $as_peIcon='none', $as_pIcon='none', $as_nIcon='none', $as_neIcon='none', $as_FileLink='', $as_IndexName='' )			{				return $this->cls_Paging->PrintPageLink( $this->GetListInfoOfBBSInfo(), $ab_pniView, $as_peIcon, $as_pIcon, $as_nIcon, $as_neIcon, $as_FileLink, $as_IndexName );			}		#endregion		#region BBS 영역 데이터 관리			/**			* BBS 구분용 변수 설정			*			* @param string		$as_BBSCode				:	게시판 구분코드			*/			function SetBBSCode( $as_BBSCode )			{				$this->cls_EZ_BBSControl->BBSCode = $as_BBSCode;			}			/**			* List 관리용 변수 설정(From DB - ez_bbsinfo)			*			* @param string		$as_BBSCode				:	게시판 구분코드			* @param string		$as_Condition			:	쿼리 조건부			* @param string		$as_Orderby				:	정렬순서			* @return boolean			*/			function LoadListInfoOfBBS( $as_BBSCode, $as_Condition="", $as_Orderby=" ORDER BY idx DESC " )			{				$this->SetBBSCode( $as_BBSCode );				if( $this->cls_EZ_BBSControl->LoadBBSConfigDataFromDB() )				{					$ii_page = $this->GetRequest( "page", 1, true );					$ii_page = ($ii_page < 1) ? 1 : $ii_page;					$this->SetListInfoFieldOfBBS( "page", $ii_page );					$this->SetListInfoFieldOfBBS( "RecordCntPerPage", $this->cls_EZ_BBSControl->GetBBSConfigData( "rows" ) );					$this->SetListInfoFieldOfBBS( "PageCntPerBlock", $this->cls_EZ_BBSControl->GetBBSConfigData( "lists" ) );					//$this->SetListInfoFieldOfBBS( "PageQuery", "" );					$this->SetListInfoFieldOfBBS( "SearchSet", "&search_option=".$this->GetRequest( "search_option", "", true )."&keyword=".urlencode($this->GetRequest( "keyword", "", true )) );					//$this->SetListInfoFieldOfBBS( "LinkOption", "" );					$is_SubSql = ($this->GetRequest( "search_option", "", true )=="") ? "" : (($this->GetRequest( "search_option", "", true )=="all") ? " AND (subject like '%".$this->GetRequest( "keyword", "", true )."%' OR content like '%".$this->GetRequest( "keyword", "", true )."%')" : " AND (".$this->GetRequest( "search_option", "", true )." like '%".$this->GetRequest( "keyword", "", true )."%')");					$this->SetListInfoFieldOfBBS( "Addwhere", $this->cls_EZ_BBSControl->GetQueryWithBBSFilter( $as_Condition.$is_SubSql ) );					//$this->SetListInfoFieldOfBBS( "SpecialTop", 0 );					$this->ReSetListInfoOfBBS( $as_Orderby );					return true;				}				else				{					$this->error( "BBS Error", "BBS config not exist : ".$as_BBSCode );					return false;				}			}			/**			* List 관리용 변수 재계산			*			* @param string		$as_Orderby				:	정렬순서			*/			function ReSetListInfoOfBBS( $as_Orderby="" )			{				$this->cls_EZ_BBSControl->ReSetListInfo( "ez_bbs", $as_Orderby );			}			/**			* List 관리용 변수 필드 셋팅			*			* @param string		$as_FieldName			:	필드명			* @param string		$as_Data				:	데이터			*/			function SetListInfoFieldOfBBS( $as_FieldName, $as_Data )			{				$this->cls_EZ_BBSControl->SetListInfoField( "ez_bbs", $as_FieldName, $as_Data );			}			/**			* List 관리용 변수 필드 설정값 획득			*			* @param string		$as_FieldName			:	필드명			* @return string/integer			*/			function GetListInfoFieldOfBBS( $as_FieldName )			{				return $this->cls_EZ_BBSControl->GetListInfoField( "ez_bbs", $as_FieldName );			}			/**			* List 관리용 변수 필드 설정 반환			*			* @return array			*/			function GetListInfoOfBBS()			{				return $this->cls_EZ_BBSControl->GetListInfo( "ez_bbs" );			}		#endregion		#region BBS 게시물 데이터 관리			/**			* 게시물 조회			*			* @return recordset			*/			function GetSelectRecordsOfBBS()			{				return $this->cls_EZ_BBSControl->GetSelectRecords( "ez_bbs", $this->GetListInfoFieldOfBBS( "Addwhere" ), $this->GetListInfoFieldOfBBS( "Orderby" ) );			}			/**			* 레코드 루프적용			*			* @param recordset	$ars_Source				:	데이터 원본 레코드셋			* @param array		$arr_Fields				:	데이터 셋팅적용 필드배열			* @return boolean			*/			function LoopForBBS( $ars_Source, $arr_Fields=null )			{				return $this->cls_EZ_BBSControl->Loop( "ez_bbs", $ars_Source, $arr_Fields );			}			/**			* 레코드 선택처리			*			* @param integer	$ai_AttachIdx			:	첨부 이미지 idx			* @return boolean			*/			function MatchAttach( $ai_AttachIdx=0 )			{				if( $ai_AttachIdx )				{					$this->cls_EZ_BBSControl->Load( "ez_attach", "idx='".$ai_AttachIdx."'", "" );	//특정 첨부파일 로딩				}				else				{					$this->cls_EZ_BBSControl->Load( "ez_attach", "bbsidx='".$this->cls_EZ_BBSControl->GetData( "ez_bbs", "idx" )."'", "ORDER BY idx ASC LIMIT 1" );	//가장 먼저 등록된 첨부파일 로딩				}				if( $this->cls_EZ_BBSControl->GetData( "ez_attach", "idx" ) )	//첨부파일 존재시				{					$this->cls_EZ_BBSControl->SetData( "ez_bbs", "upfile", $this->cls_EZ_BBSControl->GetData( "ez_attach", "upfile" ) );					$this->cls_EZ_BBSControl->SetData( "ez_bbs", "upfile_name", $this->cls_EZ_BBSControl->GetData( "ez_attach", "upfile_name" ) );					return true;				}				return false;			}			/**			* 게시판 코드확인			*			* @param string		$as_Code				:	게시판 코드			* @return boolean			*/			function IsCodeOfBBS( $as_Code )			{				return ($this->cls_EZ_BBSControl->BBSCode == $as_Code);			}		#endregion		#region BBS 게시물 페이징 출력			/**			* 페이징 처리			*			* @param boolean	$ab_pniView				:	이전/다음블럭 링크 출력여부			* @param string		$as_peIcon				:	처음블럭 링크 아이콘			* @param string		$as_pIcon				:	이전블럭 링크 아이콘			* @param string		$as_nIcon				:	다음블럭 링크 아이콘			* @param string		$as_neIcon				:	마지막블럭 링크 아이콘			* @param string		$as_FileLink			:	링크되는 페이지명			* @param string		$as_IndexName			:	페이지 번호 변수명			* @return string			*///내일보기			function PrintPageLinkOfBBS( $ab_pniView='none', $as_peIcon="<img src=\"http://image.heart-heart.org/btn/www_first.gif\" alt=\"처음으로\" />", $as_pIcon="<img src=\"http://image.heart-heart.org/btn/www_prev.gif\" alt=\"이전 블럭\" />", $as_nIcon="<img src=\"http://image.heart-heart.org/btn/www_next.gif\" alt=\"다음 블럭\" />", $as_neIcon="<img src=\"http://image.heart-heart.org/btn/www_last.gif\" alt=\"마지막으로\" />", $as_FileLink='', $as_IndexName='' )			{				return $this->cls_Paging->PrintPageLink( $this->GetListInfoOfBBS(), $ab_pniView, $as_peIcon, $as_pIcon, $as_nIcon, $as_neIcon, $as_FileLink, $as_IndexName );			}		#endregion		#region Attach 영역 데이터 관리			/**			* 게시물 조회			*			* @param string		$as_Condition			:	쿼리 조건부			* @param string		$as_Orderby				:	정렬순서			* @return recordset			*/			function GetSelectRecordsOfAttach( $as_Condition="", $as_Orderby=" ORDER BY idx ASC " )			{				return $this->cls_EZ_BBSControl->GetSelectRecords( "ez_attach", $as_Condition, $as_Orderby );			}			/**			* 레코드 루프적용			*			* @param recordset	$ars_Source				:	데이터 원본 레코드셋			* @param array		$arr_Fields				:	데이터 셋팅적용 필드배열			* @return boolean			*/			function LoopForAttach( $ars_Source, $arr_Fields=null )			{				return $this->cls_EZ_BBSControl->Loop( "ez_attach", $ars_Source, $arr_Fields );			}			/**			* 조회대상 게시물 존재여부 확인 및 로딩			*			* @param string		$as_Filter			:	조회 기본조건 설정			* @return boolean			*/			function LoadRecordOfAttach( $as_Filter="" )			{				$ii_Idx		= $this->GetRequest( "cmtidx", 0 );				$is_Filter	= " (idx='".$ii_Idx."') ".(empty($as_Filter) ? "" : "AND (".$as_Filter.") ");				if( 0 < $ii_Idx )				{					return $this->cls_EZ_BBSControl->Load( "ez_attach", $this->cls_EZ_BBSControl->GetBasicCondition( $is_Filter, "" ) );				}				return false;			}			/**			* Thumbnail Tag 생성			*			* @param string			$as_IdPrefix	:	구분자1			* @param string			$as_Prefix		:	구분자2			* @param integer		$ai_Width		:	폭			* @param integer		$ai_Height		:	높이			* @return string			*/			function GetThumbnailTagOfAttach( $as_IdPrefix='', $as_Prefix='thumbM_', $ai_Width=0, $ai_Height=0 )			{				$is_rtn = $this->cls_EZ_BBSControl->GetData( "ez_attach", 'upfile' );				$ii_Idx = $this->cls_EZ_BBSControl->GetData( "ez_attach", 'idx' );				if( $is_rtn )				{					switch( $as_Prefix )					{						case 'thumbM_':	$is_SizeInfo = " style=\"width:120px; height:110px;\"";	break;						default:							$is_SizeInfo = empty($ai_Width) ? "" : "width:".$ai_Width."px;";							$is_SizeInfo.= empty($ai_Height) ? "" : " height:".$ai_Height."px;";							$is_SizeInfo = empty($is_SizeInfo) ? "" : " style=\"".$is_SizeInfo."\"";							break;					}					$is_rtn = "<img src=\"http://www.heart-heart.org/bbs/upfile/".$this->cls_EZ_BBSControl->GetData( "ez_attach", "code" )."/".$as_Prefix.$is_rtn."\"".$is_SizeInfo." id=\"".$as_IdPrefix.$ii_Idx ."\" />";				}				return $is_rtn;			}		#endregion		#region BBS 게시물 관리			/**			* 조회대상 게시물 존재여부 확인 및 로딩			*			* @param string		$as_Filter			:	조회 기본조건 설정			* @param boolean	$ab_CodeFilter		:	코드 필터 적용여부			* @return boolean			*/			function LoadRecordOfBBS( $as_Filter="", $ab_CodeFilter=true )			{				$ii_Idx		= $this->GetRequest( "idx", 0 );				$is_Filter = " (idx='".$ii_Idx."') ";				$is_Filter.= ($ab_CodeFilter ? "AND (code = '".$this->cls_EZ_BBSControl->BBSCode."') " : "");				$is_Filter.= (empty($as_Filter) ? "" : "AND (".$as_Filter.") ");				if( 0 < $ii_Idx )				{					return $this->cls_EZ_BBSControl->Load( "ez_bbs", $is_Filter );				}				return false;			}			/**			* 조회대상 게시물 존재여부 확인 및 로딩/조회 카운트 증가			*			* @param string		$as_Filter			:	조회 기본조건 설정			* @param boolean	$ab_CodeFilter		:	코드 필터 적용여부			* @return boolean			*/			function LoadRecordOfBBSWithCountUp( $as_Filter="", $ab_CodeFilter=true )			{				if( $this->LoadRecordOfBBS( $as_Filter, $ab_CodeFilter ) )				{					$this->cls_EZ_BBSControl->ExecQuery( "UPDATE ez_bbs SET count=count+1 WHERE (idx='".$this->cls_EZ_BBSControl->GetData( "ez_bbs", "idx" )."')" );					$ii_count = $this->cls_EZ_BBSControl->GetData( "ez_bbs", "count" );					$this->cls_EZ_BBSControl->SetData( "ez_bbs", "count", $ii_count+1 );					return true;				}				return false;			}			/**			* IsPrivacyOfBBS			*			* @return boolean			*/			function IsPrivacyOfBBS()			{				return ($this->cls_EZ_BBSControl->GetData( "ez_bbs", "privacy" )=="Y");			}			/**			* IsNoticeOfBBS			*			* @return boolean			*/			function IsNoticeOfBBS()			{				return ($this->cls_EZ_BBSControl->GetData( "ez_bbs", "notice" )=="Y");			}			/**			* IsNewOfBBS			*			* @param integer			$ai_New			:	신규글 표시 기간(일)			* @return boolean			*/			function IsNewOfBBS( $ai_New=0 )			{				$ai_New = empty($ai_New) ? $this->cls_EZ_BBSControl->GetData( "ez_bbsinfo", "new" ) : $ai_New;				$iarr_Period = $this->cls_EZ_BBSControl->cls_UTLDateTime->GetPeriodInfo( "D", ($ai_New * -1) );				return ( $iarr_Period['END'] <= $this->cls_EZ_BBSControl->GetData( "ez_bbs", "wdate" ) );			}			/**			* Thumbnail Tag 생성			*			* @param string			$as_Sep			:	구분자1			* @param string			$as_Prefix		:	구분자2			* @param integer		$ai_Width		:	폭			* @param integer		$ai_Height		:	높이			* @return string			*/			function GetThumbnailTagOfBBS( $as_Sep='upfile', $as_Prefix='thumbM_', $ai_Width=0, $ai_Height=0 )			{				switch( $as_Prefix )				{					case 'thumbM_':	$is_SizeInfo = " style=\"width:120px; height:110px;\"";	break;					case 'thumbL_':	$is_SizeInfo = " style=\"width:240px; height:180px;\"";	break;					case 'thumbF_':	$is_SizeInfo = " style=\"width:125px; height:100px;\"";	break;					default:						$is_SizeInfo = empty($ai_Width) ? "" : "width:".$ai_Width."px;";						$is_SizeInfo.= empty($ai_Height) ? "" : " height:".$ai_Height."px;";						$is_SizeInfo = empty($is_SizeInfo) ? "" : " style=\"".$is_SizeInfo."\"";						break;				}				$is_rtn = $this->cls_EZ_BBSControl->GetData( "ez_bbs", $as_Sep );				if( $is_rtn )				{					$is_rtn = "<img src=\"http://www.heart-heart.org/bbs/upfile/".$this->cls_EZ_BBSControl->GetData( "ez_bbs", "code" )."/".$as_Prefix.$is_rtn."\"".$is_SizeInfo." onError=\"this.src='http://image.heart-heart.org/img/www_none.gif';\"/>";				}				else if( $as_Prefix=='thumbM_' )				{					$is_rtn = "<img src=\"http://image.heart-heart.org/img/www_none.gif\"".$is_SizeInfo." />";				}				else if( $as_Prefix=='thumbF_' )				{					$is_rtn = "<img src=\"http://image.heart-heart.org/img/www_none.gif\"".$is_SizeInfo." />";				}				return $is_rtn;			}			/**			* AttachDownload Tag 생성			*			* @param boolean		$ab_Upfile1		:	파일1 출력여부			* @param boolean		$ab_Upfile2		:	파일2 출력여부			* @param boolean		$ab_Upfile3		:	파일3 출력여부			* @return string			*/			function GetAttachDownloadTagOfBBS( $ab_Upfile1=true, $ab_Upfile2=true, $ab_Upfile3=true )			{				$is_rtn = "";				if( $ab_Upfile1 && ($this->cls_EZ_BBSControl->GetData( "ez_bbs", "upfile" )!="") )				{					$is_rtn.= empty($is_rtn) ? "" : "<br />";					$is_rtn.= "<a href='/bbsutils/bbs_down.php?code=".$this->cls_EZ_BBSControl->GetData( "ez_bbs", "code" )."&amp;idx=".$this->cls_EZ_BBSControl->GetData( "ez_bbs", "idx" )."'>".$this->cls_EZ_BBSControl->GetData( "ez_bbs", "upfile_name" )."</a>";				}				if( $ab_Upfile2 && ($this->cls_EZ_BBSControl->GetData( "ez_bbs", "upfile2" )!="") )				{					$is_rtn.= empty($is_rtn) ? "" : "<br />";					$is_rtn.= "<a href='/bbsutils/bbs_down.php?code=".$this->cls_EZ_BBSControl->GetData( "ez_bbs", "code" )."&amp;idx=".$this->cls_EZ_BBSControl->GetData( "ez_bbs", "idx" )."&amp;no=2'>".$this->cls_EZ_BBSControl->GetData( "ez_bbs", "upfile2_name" )."</a>";				}				if( $ab_Upfile3 && ($this->cls_EZ_BBSControl->GetData( "ez_bbs", "upfile3" )!="") )				{					$is_rtn.= empty($is_rtn) ? "" : "<br />";					$is_rtn.= "<a href='/bbsutils/bbs_down.php?code=".$this->cls_EZ_BBSControl->GetData( "ez_bbs", "code" )."&amp;idx=".$this->cls_EZ_BBSControl->GetData( "ez_bbs", "idx" )."&amp;no=3'>".$this->cls_EZ_BBSControl->GetData( "ez_bbs", "upfile3_name" )."</a>";				}				$is_rtn = empty($is_rtn) ? "첨부파일 없음" : $is_rtn;				return $is_rtn;			}			/**			* Selected AttachDownload Tag 생성			*			* @param string			$as_Sep			:	구분자1			* @param string			$as_Display		:	a tag 사이에 들어갈 html element			* @param string			$as_Empty		:	파일 부재시 출력요소			* @return string			*/			function GetSelectedAttachDownloadTagOfBBS( $as_Sep='upfile', $as_Display='', $as_Empty='첨부파일 없음' )			{				$is_rtn = $as_Empty;				if( $this->cls_EZ_BBSControl->GetData( "ez_bbs", $as_Sep )!="" )				{					switch($as_Sep)					{						case "upfile":	$is_no = "";	break;						case "upfile2":	$is_no = "2";	break;						case "upfile3":	$is_no = "3";	break;						default:	break;					}					$is_rtn = "<a href='/bbsutils/bbs_down.php?code=".$this->cls_EZ_BBSControl->GetData( "ez_bbs", "code" )."&amp;idx=".$this->cls_EZ_BBSControl->GetData( "ez_bbs", "idx" )."&amp;no=".$is_no."'>";					$is_rtn.= (empty($as_Display) ? $this->cls_EZ_BBSControl->GetData( "ez_bbs", $as_Sep."_name" ) : $as_Display);					$is_rtn.= "</a>";				}				return $is_rtn;			}		#endregion		#region BBS Link 관리			/**			* 역할별 페이지 링크 설정			*			* @param string		$as_FieldName		:	페이지 역할구분			* @param string		$as_PageLink		:	페이지 링크			*/			function SetPageLink( $as_FieldName, $as_PageLink )			{				$this->ListPageName[$as_FieldName] = $as_PageLink;			}			/**			* 역할별 페이지 링크 반환			*			* @param string		$as_FieldName		:	페이지 역할구분			*/			function GetPageLink( $as_FieldName )			{				return $this->ListPageName[$as_FieldName];			}			/**			* 리스트 페이지 링크 반환			*			* @param string		$as_Group		:	그룹구분			*/			function GetPageLinkOfList( $as_Group="" )			{				$is_Grp = empty($as_Group) ? $this->GetRequest( "grp", $this->cls_EZ_BBSControl->GetData( "ez_bbs", "grp" ), true ) : $as_Group;				$is_Grp = empty($is_Grp) ? "" : "&amp;grp=".urlencode($is_Grp);				return $this->GetPageLink("LIST")."?page=".$this->GetRequest( "page", 1, true )."&amp;search_option=".$this->GetRequest( "search_option", "", true )."&amp;keyword=".urlencode($this->GetRequest( "keyword", "", true )).$is_Grp;			}			/**			* 뷰 페이지 링크 반환			*			*/			function GetPageLinkOfView()			{				$is_Grp = $this->GetRequest( "grp", $this->cls_EZ_BBSControl->GetData( "ez_bbs", "grp" ), true );				$is_Grp = empty($is_Grp) ? "" : "&amp;grp=".urlencode($is_Grp);				return $this->GetPageLink("VIEW")."?page=".$this->GetRequest( "page", 1, true )."&amp;search_option=".$this->GetRequest( "search_option", "", true )."&amp;keyword=".urlencode($this->GetRequest( "keyword", "", true )).$is_Grp."&amp;idx=".$this->cls_EZ_BBSControl->GetData( "ez_bbs", "idx" );			}			/**			* 작성 페이지 링크 반환			*			*/			function GetPageLinkOfWrite()			{				$is_Grp = $this->GetRequest( "grp", $this->cls_EZ_BBSControl->GetData( "ez_bbs", "grp" ), true );				$is_Grp = empty($is_Grp) ? "" : "?grp=".urlencode($is_Grp);				return $this->GetPageLink("WRITE").$is_Grp;			}			/**			* 수정 페이지 링크 반환			*			*/			function GetPageLinkOfModify()			{				$is_Grp = $this->GetRequest( "grp", $this->cls_EZ_BBSControl->GetData( "ez_bbs", "grp" ), true );				$is_Grp = empty($is_Grp) ? "" : "&amp;grp=".urlencode($is_Grp);				return $this->GetPageLink("EDIT")."?mode=update&amp;page=".$this->GetRequest( "page", 1, true )."&amp;search_option=".$this->GetRequest( "search_option", "", true )."&amp;keyword=".urlencode($this->GetRequest( "keyword", "", true )).$is_Grp."&amp;idx=".$this->cls_EZ_BBSControl->GetData( "ez_bbs", "idx" );			}			/**			* 답변작성 페이지 링크 반환			*			*/			function GetPageLinkOfReply()			{				$is_Grp = $this->GetRequest( "grp", $this->cls_EZ_BBSControl->GetData( "ez_bbs", "grp" ), true );				$is_Grp = empty($is_Grp) ? "" : "&amp;grp=".urlencode($is_Grp);				return $this->GetPageLink("WRITE")."?mode=reply&amp;page=".$this->GetRequest( "page", 1, true )."&amp;search_option=".$this->GetRequest( "search_option", "", true )."&amp;keyword=".urlencode($this->GetRequest( "keyword", "", true )).$is_Grp."&amp;idx=".$this->cls_EZ_BBSControl->GetData( "ez_bbs", "idx" );			}			/**			* 삭제 페이지 링크 반환			*			*/			function GetPageLinkOfRemove()			{				$is_Grp = $this->GetRequest( "grp", $this->cls_EZ_BBSControl->GetData( "ez_bbs", "grp" ), true );				$is_Grp = empty($is_Grp) ? "" : "&amp;grp=".urlencode($is_Grp);				return $this->GetPageLink("DEL")."?mode=delete&amp;page=".$this->GetRequest( "page", 1, true )."&amp;search_option=".$this->GetRequest( "search_option", "", true )."&amp;keyword=".urlencode($this->GetRequest( "keyword", "", true )).$is_Grp."&amp;idx=".$this->cls_EZ_BBSControl->GetData( "ez_bbs", "idx" );			}		#endregion		#region 페이지 영역별 출력			/**			* 그룹별 URL 생성			*			* @param string			$as_Grp			:	그룹			* @return string			*/			function GetCategoryLink( $as_Grp )			{				$is_rtn = $this->GetPageLink( "LIST" ).(empty($as_Grp) ? "" : "?grp=".urlencode($as_Grp));				return $is_rtn;			}		#endregion		#region Comment 영역 데이터 관리			/**			* 게시물 조회			*			* @param string		$as_Condition			:	쿼리 조건부			* @param string		$as_Orderby				:	정렬순서			* @return recordset			*/			function GetSelectRecordsOfComment( $as_Condition="", $as_Orderby=" ORDER BY idx DESC " )			{				return $this->cls_EZ_BBSControl->GetSelectRecords( "ez_comment", $this->cls_EZ_BBSControl->GetQueryWithCommentFilter( $as_Condition ), $as_Orderby );			}			/**			* 레코드 루프적용			*			* @param recordset	$ars_Source				:	데이터 원본 레코드셋			* @param array		$arr_Fields				:	데이터 셋팅적용 필드배열			* @return boolean			*/			function LoopForComment( $ars_Source, $arr_Fields=null )			{				return $this->cls_EZ_BBSControl->Loop( "ez_comment", $ars_Source, $arr_Fields );			}			/**			* 조회대상 게시물 존재여부 확인 및 로딩			*			* @param string		$as_Filter			:	조회 기본조건 설정			* @return boolean			*/			function LoadRecordOfComment( $as_Filter="" )			{				$ii_Idx		= $this->GetRequest( "cmtidx", 0 );				$is_Filter	= " (idx='".$ii_Idx."') ".(empty($as_Filter) ? "" : "AND (".$as_Filter.") ");				if( 0 < $ii_Idx )				{					return $this->cls_EZ_BBSControl->Load( "ez_comment", $this->cls_EZ_BBSControl->GetQueryWithCommentFilter( $is_Filter ) );				}				return false;			}		#endregion		#region Secure Code			/**			* 보안코드 생성 및 세션등록처리			*			* @return string			*/			function GetSecureCode()			{				global $_SESSION;				$tmp_str = substr(md5(time()),0,10);				list($usec, $sec) = explode(' ', microtime());				$seed = (float)$sec + ((float)$usec * 100000);				srand($seed);				$keylen = strlen($tmp_str);				$div = (int)($keylen / 2);				while (count($arr) < 3)				{					unset($arr);					for ($i=0; $i<$keylen; $i++)					{						$rnd = rand(1, $keylen);						$arr[$rnd] = $rnd;						if ($rnd > $div) break;					}				}				sort($arr);				$norobot_key = "";				$norobot_str = "";				$m = 0;				for ($i=0; $i<count($arr); $i++)				{					for ($k=$m; $k<$arr[$i]-1; $k++)						$norobot_str .= $tmp_str[$k];					$norobot_str .= "<span class='norobot'>{$tmp_str[$k]}</span>";					$norobot_key .= $tmp_str[$k];					$m = $k + 1;				}				if ($m < $keylen)				{					for ($k=$m; $k<$keylen; $k++)						$norobot_str .= $tmp_str[$k];				}				$norobot_str = "<span class='robot'>$norobot_str</span>";				//session_start();				$_SESSION["answer_session"] = $norobot_key;				return $norobot_str;			}			/**			* 보안코드 생성 및 세션등록처리			*			* @return string			*/			function GetSecureCodeOfAllow()			{				global $_SESSION;				return $_SESSION["answer_session"];			}			/**			* 보안코드 비교체크			*			* @param string		$as_Code		:	보안코드			* @return boolean			*/			function IsSecureCodeAllow( $as_Code )			{				return ( empty($this->SESSION["answer_session"]) ? false : ($this->SESSION["answer_session"] == $as_Code) );			}		#endregion	}}?>