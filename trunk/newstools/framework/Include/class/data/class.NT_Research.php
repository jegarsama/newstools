<?php#region License Statement	// Copyright (c) SeniorPartners. All rights reserved.	//	// 클래스명	: NT_Research	// 경로		: [framework]/_include/class/data/	// 코드		: ANSI	// 설명		: 설문조사 모듈 클래스	// 작성자	: 김성호 (sh.kim@yourstage.com)	// 소속명	: Development Team	// 수정일	: 20090817#endregionif( !class_exists("NT_Research") ){	require_once "class.BaseModule.php";	class NT_Research extends BaseModule	{		var $RS_Question= null;		var $RS_Example	= null;		var $Arr_Area		= Array('서울'=>'서울', '경기'=>'경기', '강원'=>'강원', '충북'=>'충북', '충남'=>'충남', '전북'=>'전북', '전남'=>'전남', '경북'=>'경북', '경남'=>'경남', '제주'=>'제주');		var $Arr_Age		= Array('10대 미만'=>'10대 미만', '10대'=>'10대', '20대'=>'20대', '30대'=>'30대', '40대'=>'40대', '50대'=>'50대', '60대 이상'=>'60대 이상');		var $Arr_Sex		= Array('M'=>'남', 'F'=>'여');		var $Arr_Edugrade	= Array('초졸'=>'초졸', '중졸'=>'중졸', '고졸'=>'고졸', '대졸'=>'대졸', '대학원졸'=>'대학원졸', '기타'=>'기타');		var $Arr_Religion	= Array('기독교'=>'기독교', '불교'=>'불교', '천주교'=>'천주교', '원불교'=>'원불교', '무교'=>'무교', '기타'=>'기타');		//클래스 생성자		function NT_Research()		{			parent::BaseModule();			$this->Prefix = "NT_";			$this->InitField( "RESEARCH_SUBJECT" );	//설문조사 정보			$this->InitField( "RESEARCH_QUESTION" );//설문문항 정보			$this->InitField( "RESEARCH_EXAMPLE" );	//설문보기 정보			$this->InitField( "RESEARCH_ANSWER" );	//응답자 정보			$this->InitField( "RESEARCH_VOTE" );	//답변 정보			$this->InitListInfo( "RESEARCH_SUBJECT" );	//설문조사 List 관리용 변수 초기화		}		#region Base Statement			/**			* 데이터 초기화			*			* @param string		$as_TableName			:	테이블명			*/			function InitField( $as_TableName )			{				switch( $as_TableName )				{					case "RESEARCH_SUBJECT":						$this->Fields[$this->Prefix.$as_TableName]	= Array(															'rcode'			=> Array('ISFIELD'=>true, 'USED'=>false, 'TYPE'=>"VALUE", 'DATA'=>0),	//설문코드															'subject'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//설문제목															'desc'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//설명문구															'sdate'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//설문시작일시															'edate'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//설문종료일시															'adminID'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//최종수정자아이디															'wdate'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"")	//등록일시															);						break;					case "RESEARCH_QUESTION":						$this->Fields[$this->Prefix.$as_TableName]	= Array(															'rcode'			=> Array('ISFIELD'=>true, 'USED'=>false, 'TYPE'=>"VALUE", 'DATA'=>0),	//설문코드															'qcode'			=> Array('ISFIELD'=>true, 'USED'=>false, 'TYPE'=>"VALUE", 'DATA'=>0),	//문항코드															'qtype'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"DESC"),	//문항유형 : DESC-설명, radio-단일, checkbox-다중, text-주관식															'qdisplay'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"block"),	//출력방식 : css style display attribute value															'qmustans'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"Y"),	//필수응답여부															'subject'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//문항제목															'desc'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//설명문구															'anslimit'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>0),	//답변선택 제한 개수															'oidx'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>0),	//정렬순서															'adminID'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//최종수정자아이디															'wdate'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"")	//등록일시															);						break;					case "RESEARCH_EXAMPLE":						$this->Fields[$this->Prefix.$as_TableName]	= Array(															'rcode'			=> Array('ISFIELD'=>true, 'USED'=>false, 'TYPE'=>"VALUE", 'DATA'=>0),	//설문코드															'qcode'			=> Array('ISFIELD'=>true, 'USED'=>false, 'TYPE'=>"VALUE", 'DATA'=>0),	//문항코드															'ecode'			=> Array('ISFIELD'=>true, 'USED'=>false, 'TYPE'=>"VALUE", 'DATA'=>0),	//보기코드															'desc'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//설명문구															'oidx'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>0),	//정렬순서															'adminID'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//최종수정자아이디															'wdate'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"")	//등록일시															);						break;					case "RESEARCH_ANSWER":						$this->Fields[$this->Prefix.$as_TableName]	= Array(															'rcode'			=> Array('ISFIELD'=>true, 'USED'=>false, 'TYPE'=>"VALUE", 'DATA'=>0),	//설문코드															'acode'			=> Array('ISFIELD'=>true, 'USED'=>false, 'TYPE'=>"VALUE", 'DATA'=>0),	//응답자코드															'memID'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//응답자아이디															'area'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//설문제목															'age'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//나이대															'sex'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"U"),	//성별															'edugrade'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//교육수준															'religion'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//종교															'ip'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//IP															'wdate'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"")	//등록일시															);						break;					case "RESEARCH_VOTE":						$this->Fields[$this->Prefix.$as_TableName]	= Array(															'rcode'			=> Array('ISFIELD'=>true, 'USED'=>false, 'TYPE'=>"VALUE", 'DATA'=>0),	//설문코드															'acode'			=> Array('ISFIELD'=>true, 'USED'=>false, 'TYPE'=>"VALUE", 'DATA'=>0),	//응답자코드															'qcode'			=> Array('ISFIELD'=>true, 'USED'=>false, 'TYPE'=>"VALUE", 'DATA'=>0),	//문항코드															'ecode'			=> Array('ISFIELD'=>true, 'USED'=>false, 'TYPE'=>"VALUE", 'DATA'=>0),	//보기코드															'desc'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//설명문구															'wdate'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"")	//등록일시															);						break;					default:						parent::InitField( $as_TableName );						break;				}			}			/**			* 레코드 삽입			*			* @param string		$as_TableName			:	테이블명			* @return boolean			*/			function Insert( $as_TableName )			{				switch( $as_TableName )				{					case "RESEARCH_SUBJECT":	//특정필드 데이터 설정						$this->SetData( $as_TableName, "rcode", time() );						$this->SetData( $as_TableName, "wdate", "now()", "METHOD" );						break;					case "RESEARCH_QUESTION":	//특정필드 데이터 설정						$this->SetData( $as_TableName, "wdate", "now()", "METHOD" );						break;					case "RESEARCH_EXAMPLE":	//특정필드 데이터 설정						$this->SetData( $as_TableName, "wdate", "now()", "METHOD" );						break;					case "RESEARCH_ANSWER":	//특정필드 데이터 설정						$this->SetData( $as_TableName, "acode", time() );						$this->SetData( $as_TableName, "wdate", "now()", "METHOD" );						break;					case "RESEARCH_VOTE":	//특정필드 데이터 설정						$this->SetData( $as_TableName, "wdate", "now()", "METHOD" );						break;					default:						break;				}				return parent::Insert( $as_TableName );			}			/**			* 레코드 반영			*			* @param string		$as_TableName			:	테이블명			* @param string		$as_Condition			:	쿼리 조건부			* @return boolean			*/			function Update( $as_TableName, $as_Condition )			{				switch( $as_TableName )				{					case "RESEARCH_SUBJECT":	//키값 및 기타 데이터 변경방지						$this->SetUsable( $as_TableName, 'rcode', false );						$this->SetUsable( $as_TableName, 'wdate', false );						break;					case "RESEARCH_QUESTION":	//키값 및 기타 데이터 변경방지						$this->SetUsable( $as_TableName, 'rcode', false );						$this->SetUsable( $as_TableName, 'qcode', false );						$this->SetUsable( $as_TableName, 'wdate', false );						break;					case "RESEARCH_EXAMPLE":	//키값 및 기타 데이터 변경방지						$this->SetUsable( $as_TableName, 'rcode', false );						$this->SetUsable( $as_TableName, 'qcode', false );						$this->SetUsable( $as_TableName, 'ecode', false );						$this->SetUsable( $as_TableName, 'wdate', false );						break;					case "RESEARCH_ANSWER":	//키값 및 기타 데이터 변경방지						$this->SetUsable( $as_TableName, 'rcode', false );						$this->SetUsable( $as_TableName, 'acode', false );						$this->SetUsable( $as_TableName, 'memID', false );						$this->SetUsable( $as_TableName, 'ip', false );						$this->SetUsable( $as_TableName, 'wdate', false );						break;					default:						break;				}				return parent::Update( $as_TableName, $as_Condition );			}			/**			* 레코드 삭제			*			* @param string		$as_TableName			:	테이블명			* @param string		$as_Condition			:	쿼리 조건부			* @return boolean			*/			function Del( $as_TableName, $as_Condition )			{				return parent::Del( $as_TableName, $as_Condition );			}		#endregion		#region Load Research Info			/**			* 설문정보 조회			*			* @param int		$ai_RCode			:	설문코드			* @return recordset			*/			function LoadResearchInfo( $ai_RCode )			{				return $this->Load( "RESEARCH_SUBJECT", " WHERE (rcode='".$ai_RCode."') " );			}			/**			* 문항정보 조회			*			* @param int		$ai_RCode			:	설문코드			* @param int		$ai_QCode			:	문항코드			* @return recordset			*/			function LoadQuestionInfo( $ai_RCode, $ai_QCode )			{				return $this->Load( "RESEARCH_QUESTION", " WHERE (rcode='".$ai_RCode."') AND (qcode='".$ai_QCode."') " );			}			/**			* 보기정보 조회			*			* @param int		$ai_RCode			:	설문코드			* @param int		$ai_QCode			:	문항코드			* @param int		$ai_ECode			:	보기코드			* @return recordset			*/			function LoadExampleInfo( $ai_RCode, $ai_QCode, $ai_ECode )			{				return $this->Load( "RESEARCH_EXAMPLE", " WHERE (rcode='".$ai_RCode."') AND (qcode='".$ai_QCode."') AND (ecode='".$ai_ECode."') " );			}			/**			* 문항 조회			*			*/			function LoadQuestionRecords()			{				$this->RS_Question = $this->GetSelectRecords( "RESEARCH_QUESTION", " WHERE (rcode='".$this->GetData( "RESEARCH_SUBJECT", "rcode" )."') ", " ORDER BY oidx, qcode " );			}			/**			* 보기 조회			*			*/			function LoadExampleRecords()			{				$this->RS_Example = $this->GetSelectRecords( "RESEARCH_EXAMPLE", " WHERE (rcode='".$this->GetData( "RESEARCH_QUESTION", "rcode" )."') AND (qcode='".$this->GetData( "RESEARCH_QUESTION", "qcode" )."') ", " ORDER BY oidx, ecode " );			}			/**			* 문항 레코드 루프적용			*			* @return boolean			*/			function LoopForQuestion()			{				if ($this->RS_Question===null) $this->LoadQuestionRecords();				return $this->Loop( "RESEARCH_QUESTION", $this->RS_Question );			}			/**			* 보기 레코드 루프적용			*			* @return boolean			*/			function LoopForExample()			{				if ($this->RS_Example===null) $this->LoadExampleRecords();				return $this->Loop( "RESEARCH_EXAMPLE", $this->RS_Example );			}			/**			* 문항별 결과 레포팅 기준 배열구조 반환			*			* @return array			*/			function GetReportTitleInfo()			{				$rtn = Array();				while( $this->LoopForQuestion() )				{					$queList = Array();					$queList['qcode']	= $this->GetData( "RESEARCH_QUESTION", "qcode" );					$queList['qtype']	= $this->GetData( "RESEARCH_QUESTION", "qtype" );					$queList['qmustans']= $this->GetData( "RESEARCH_QUESTION", "qmustans" );					$queList['subject']	= $this->GetData( "RESEARCH_QUESTION", "subject" );					$queList['desc']	= $this->GetData( "RESEARCH_QUESTION", "desc" );					$queList['exam']	= Array();					if( $queList['qtype']=='DESC' )						continue;					$this->LoadExampleRecords();					while( $this->LoopForExample() )					{						$examList = Array();						$examList['ecode']	= $this->GetData( "RESEARCH_EXAMPLE", "ecode" );						$examList['desc']	= $this->GetData( "RESEARCH_EXAMPLE", "desc" );						$queList['exam'][$examList['ecode']] = $examList['desc'];					}					$rtn[$queList['qcode']] = $queList;				}				return $rtn;			}		#endregion		#region Html Element Print			/**			* Html Element - Table			*			* @param string		$as_Content			:	추가내용			* @return string			*/			function GetTableTag( $as_Content )			{				return "<table>".$as_Content."</table>";			}			/**			* Html Element - Tr			*			* @param string		$as_Content			:	추가내용			* @return string			*/			function GetTrTag( $as_Content )			{				return "<tr>".$as_Content."</tr>";			}			/**			* Html Element - Td			*			* @param string		$as_Content			:	추가내용			* @param string		$as_Opt				:	Option			* @return string			*/			function GetTdTag( $as_Content, $as_Opt='' )			{				$as_Opt = empty($as_Opt) ? '' : ' '.$as_Opt;				return "<td".$as_Opt.">".$as_Content."</td>";			}		#endregion	}}?>