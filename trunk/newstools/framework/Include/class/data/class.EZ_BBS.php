<?php#region License Statement	// Copyright (c) SeniorPartners. All rights reserved.	//	// 클래스명	: EZ_BBS	// 경로		: [framework]/_include/class/data/	// 코드		: ANSI	// 설명		: 게시판 모듈 클래스	// 작성자	: 김성호 (sh.kim@yourstage.com)	// 소속명	: Development Team	// 수정일	: 20090323#endregionif( !class_exists("EZ_BBS") ){	require_once "class.BaseModule.php";	class EZ_BBS extends BaseModule	{		var $BBSCode = "";	//게시판 구분코드		//클래스 생성자		function EZ_BBS()		{			parent::BaseModule();			$this->InitField( "ez_bbsinfo" );	//게시판 정보			$this->InitField( "ez_bbs" );		//게시물 정보			$this->InitField( "ez_comment" );	//코멘트 정보			$this->InitField( "ez_attach" );	//첨부이미지 정보			$this->InitListInfo( "ez_bbsinfo" );//게시판 List 관리용 변수 초기화			$this->InitListInfo( "ez_bbs" );	//게시물 List 관리용 변수 초기화			$this->InitListInfo( "ez_comment" );//코멘트 List 관리용 변수 초기화			$this->InitListInfo( "ez_attach" );	//첨부이미지 List 관리용 변수 초기화		}		#region Base Statement			/**			* 데이터 초기화			*			* @param string		$as_TableName			:	테이블명			*/			function InitField( $as_TableName )			{				switch( $as_TableName )				{					case "ez_bbsinfo":						$this->Fields[$as_TableName]	= Array(															'code'			=> Array('ISFIELD'=>true, 'USED'=>false, 'TYPE'=>"VALUE", 'DATA'=>""),															'title'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'titleimg'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'header'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'footer'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'grp'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'lpermi'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'rpermi'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'wpermi'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'apermi'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'cpermi'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'bbstype'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"BBS"),															'skintype'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'usetype'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"Y"),															'privacy'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'upfile'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"N"),															'comment'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"N"),															'remail'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"N"),															'imgview'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'abuse'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'abtxt'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'rows'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>10),															'lists'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>5),															'new'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>2),															'hot'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>300),															'sitecode'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'url'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"")															);						break;					case "ez_bbs":						$this->Fields[$as_TableName]	= Array(															'idx'			=> Array('ISFIELD'=>true, 'USED'=>false, 'TYPE'=>"VALUE", 'DATA'=>0),	//key															'code'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//게시판 코드															'parno'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>0),	//부모글 key : reply 인 경우 본래 글 idx															'prino'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>0),	//정렬순서															'depno'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>0),	//깊이 : reply 인 경우 본래 글 보다 +1															'notice'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//공지사항 여부															'grp'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//카테고리 구분															'memid'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//작성자 아이디															'name'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//이름															'email'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//이메일															'subject'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//제목/공연명															'content'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//내용															'ctype'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"H"),	//content type : H-html, T-text (현재는 의미없음)															'privacy'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"N"),	//비밀글 여부															'upfile'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//첨부파일 1															'upfile2'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//첨부파일 2															'upfile3'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//첨부파일 3															'upfile_name'	=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//첨부파일(원래파일명) 1															'upfile2_name'	=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//첨부파일(원래파일명) 2															'upfile3_name'	=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//첨부파일(원래파일명) 3															'passwd'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//패스워드															'count'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>0),	//조회수															'recom'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>0),	//?															'ip'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//작성자 IP															'wdate'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//작성일															'sdate'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"1970-01-01 00:00:00"),	//이벤트 기간(시작일)															'edate'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"1970-01-01 23:59:59"),	//이벤트 기간(종료일)															'movie_url'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//동영상 URL															'playdate'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//공연일시															'playground'	=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//장소															'playconductor'	=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//지휘															'playwith'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//협연															'playprogram'	=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//프로그램															'playout'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//출연															'playhost'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//주최															'playmanage'	=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//주관															'playsupport'	=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//후원															'playcrowd'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//관람연령(대상)															'playask'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//문의															'playprice'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//가격															'playticket'	=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//티켓안내															'position'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"")	//특정위치노출															);						break;					case "ez_comment":						$this->Fields[$as_TableName]	= Array(															'idx'			=> Array('ISFIELD'=>true, 'USED'=>false, 'TYPE'=>"VALUE", 'DATA'=>0),															'bbsidx'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'prdcode'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'star'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>0),															'id'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'name'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'content'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'passwd'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'wdate'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'wip'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"")															);						break;					case "ez_attach":						$this->Fields[$as_TableName]	= Array(															'idx'			=> Array('ISFIELD'=>true, 'USED'=>false, 'TYPE'=>"VALUE", 'DATA'=>0),															'bbsidx'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'code'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),	//게시판 코드															'upfile'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'upfile_name'	=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'content'		=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>""),															'wdate'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"0000-00-00"),															'ip'			=> Array('ISFIELD'=>true, 'USED'=>true, 'TYPE'=>"VALUE", 'DATA'=>"0.0.0.0")															);						break;					default:						parent::InitField( $as_TableName );						break;				}			}			/**			* 레코드 삽입			*			* @param string		$as_TableName			:	테이블명			* @return boolean			*/			function Insert( $as_TableName )			{				switch( $as_TableName )				{					case "ez_bbsinfo":	//특정필드 데이터 설정						$this->SetUsable( $as_TableName, 'code', true );						break;					case "ez_bbs":		//특정필드 데이터 설정						$this->SetUsable( $as_TableName, 'idx', false );						if( $this->GetData( $as_TableName, 'wdate' )=='' )	$this->SetData( $as_TableName, "wdate", "now()", "METHOD" );						break;					case "ez_comment":	//특정필드 데이터 설정						$this->SetUsable( $as_TableName, 'idx', false );						$this->SetData( $as_TableName, "wdate", "now()", "METHOD" );						break;					case "ez_attach":						$this->SetUsable( $as_TableName, 'idx', false );						$this->SetData( $as_TableName, "wdate", "now()", "METHOD" );					default:						break;				}				return parent::Insert( $as_TableName );			}			/**			* 레코드 반영			*			* @param string		$as_TableName			:	테이블명			* @param string		$as_Condition			:	쿼리 조건부			* @return boolean			*/			function Update( $as_TableName, $as_Condition )			{				switch( $as_TableName )				{					case "ez_bbsinfo":	//키값 및 기타 데이터 변경방지						$this->SetUsable( $as_TableName, 'code', false );						break;					case "ez_bbs":		//특정필드 데이터 설정						$this->SetUsable( $as_TableName, 'idx', false );						$this->SetUsable( $as_TableName, 'code', false );						if( $this->GetData( $as_TableName, 'wdate' )=='' )	$this->SetData( $as_TableName, "wdate", "now()", "METHOD" );						break;					case "ez_comment":	//특정필드 데이터 설정						$this->SetUsable( $as_TableName, 'idx', false );						$this->SetUsable( $as_TableName, 'bbsidx', false );						$this->SetUsable( $as_TableName, 'prdcode', false );						$this->SetUsable( $as_TableName, 'wdate', false );						break;					case "ez_attach":						$this->SetUsable( $as_TableName, 'idx', false );						$this->SetUsable( $as_TableName, 'bbsidx', false );						if( $this->GetData( $as_TableName, 'wdate' )=='' )	$this->SetData( $as_TableName, "wdate", "now()", "METHOD" );					default:						break;				}				return parent::Update( $as_TableName, $as_Condition );			}			/**			* 레코드 삭제			*			* @param string		$as_TableName			:	테이블명			* @param string		$as_Condition			:	쿼리 조건부			* @return boolean			*/			function Del( $as_TableName, $as_Condition )			{				return parent::Del( $as_TableName, $as_Condition );			}		#endregion		#region BBS Info Statement			/**			* 게시판 속성 데이터 로딩			*			* @return boolean			*/			function LoadBBSConfigDataFromDB()			{				$this->Load( "ez_bbsinfo", $this->GetQueryWithBBSFilter() );				return (strtolower($this->BBSCode) == strtolower($this->GetData( "ez_bbsinfo", "code" )));			}			/**			* 게시판 속성 데이터 획득			*			* @param string		$as_FieldName			:	필드명			* @return string			*/			function GetBBSConfigData( $as_FieldName )			{				return $this->GetData( "ez_bbsinfo", $as_FieldName );			}			/**			* 게시판 유형 명칭			*			* @param string		$as_TypeCode			:	유형코드			* @return string			*/			function GetBBSTypeName( $as_TypeCode='' )			{				$as_TypeCode = empty($as_TypeCode) ? $this->GetBBSConfigData( "bbstype" ) : $as_TypeCode;				switch( $as_TypeCode )				{					case "BBS":		$is_rtn = "게시판";	break;					case "PDS":		$is_rtn = "자료실";	break;					case "PHOTO":	$is_rtn = "갤러리";	break;					case "MOVIE":	$is_rtn = "동영상";	break;					default:		$is_rtn = "게시판";	break;				}				return $is_rtn;			}		#endregion		#region Query Controrl Statement			/**			* 쿼리시 BBS Code 조건절 추가반환			*			* @param string		$as_Condition			:	쿼리 특수 조건부			* @return string			*/			function GetQueryWithBBSFilter( $as_Condition="" )			{				$is_SQL = empty($this->BBSCode) ? "" : "CODE='".$this->BBSCode."'";				return $this->GetBasicCondition( $is_SQL, $as_Condition );			}			/**			* 쿼리시 Comment Code 조건절 추가반환			*			* @param string		$as_Condition			:	쿼리 특수 조건부			* @return string			*/			function GetQueryWithCommentFilter( $as_Condition="" )			{				$is_SQL = empty($this->BBSCode) ? "" : "PRDCODE='".$this->BBSCode."'";				return $this->GetBasicCondition( $is_SQL, $as_Condition );			}			/**			* 레코드 반영			*			* @param string		$as_Condition			:	쿼리 조건부			* @return boolean			*/			function IncPrino( $as_Condition )			{				$this->SetAllFieldsDisable( "ez_bbs" );				$this->SetData( "ez_bbs", "prino", "prino+1", "METHOD" );				$ib_rtn = $this->Update( "ez_bbs", $as_Condition );				$this->SetAllFieldsDisable( "ez_bbs", true );				return $ib_rtn;			}			/**			* 게시물 보기권한 체크			*			* @param string		$as_Passwd			:	패스워드			* @return boolean			*/			function AuthorizeBBS( $as_Passwd )			{				$ib_rtn = false;				if( $as_Passwd == $this->GetData( "ez_bbs", "passwd" ) )				{					$ib_rtn = true;				}				else if( 0 < $this->GetRecordCounts( "ez_bbs", "idx='".$this->GetData( "ez_bbs", "parno" )."' AND passwd='".$as_Passwd."'" ) )	//부모글의 패스워드를 입력한 경우				{					$ib_rtn = true;				}				return $ib_rtn;			}		#endregion		#region Content Convert			/**			* 쿼리시 BBS Code 조건절 추가반환			*			* @param integer		$ai_Width			:	동영상 폭			* @param integer		$ai_Height			:	동영상 높이			* @return string			*/			function GetMoveTagOfBBS( $ai_Width=502, $ai_Height=399 )			{				$is_rtn = "";				$is_Movie = $this->GetData( "ez_bbs", "movie_url" );				if( eregi("\.swf", $is_Movie) )		//http://flvs.daum.net/flvPlayer.swf?vid=unnfdsAnOPY$				{					/*					$is_rtn = "<object type='application/x-shockwave-flash' width='".$ai_Width."px' height='".$ai_Height."px' align='middle' classid='clsid:d27cdb6e-ae6d-11cf-96b8-444553540000' codebase='http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,0,0'>\n";					$is_rtn.= "<param name='movie' value='[movie]' />\n";					$is_rtn.= "<param name='allowScriptAccess' value='always' />\n";					$is_rtn.= "<param name='allowFullScreen' value='true' />\n";					$is_rtn.= "<param name='bgcolor' value='#000000' />\n";					$is_rtn.= "<embed src='[movie]' width='".$ai_Width."px' height='".$ai_Height."px' allowScriptAccess='always' type='application/x-shockwave-flash' allowFullScreen='true' bgcolor='#000000' ></embed>";					$is_rtn.= "</object>";					*/					$is_rtn = "<script type=\"text/javascript\">AC_FL_RunContent2( 'codebase','http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0',";					$is_rtn.= "'width','".$ai_Width."','height','".$ai_Height."','title','','src','[movie]','quality','high','pluginspage','http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash','movie','[movie]'); //end AC code</script>";					$is_rtn = str_replace("[movie]", $is_Movie, $is_rtn);				}				elseif( eregi("\.wmv", $is_Movie) )		//mms://yesheart.cafe24.com/yesheart/wind1.wmv				{					$is_rtn = "<embed width='".$ai_Width."' height='".$ai_Height."px' autoplay='false' src='[movie]' style='border: #a1badf 0px solid;'></embed>";					$is_rtn = str_replace("[movie]", $is_Movie, $is_rtn);				}				elseif( eregi("\.asf", $is_Movie) )		//mms://yesheart.cafe24.com/yesheart/wind1.wmv				{					$is_rtn = "<embed width='".$ai_Width."' height='".$ai_Height."px' autoplay='false' src='[movie]' style='border: #a1badf 0px solid;'></embed>";					$is_rtn = str_replace("[movie]", $is_Movie, $is_rtn);				}				elseif( $is_Movie )				{					$is_rtn = "해당 자료의 출력패턴을 찾을 수 없습니다.<br /><br />시스템 관리자에게 문의바랍니다.<br /><br />[".$is_Movie."]";				}				else				{					$is_rtn = "등록된 동영상 자료가 없습니다.";				}				return $is_rtn;			}		#endregion	}}?>