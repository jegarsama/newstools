<?php#region License Statement	// Copyright (c) SeniorPartners. All rights reserved.	//	// 클래스명	: MainPage	// 경로		: [orchestra]/_include/class/pages/	// 코드		: ANSI	// 설명		: 오케스트라소개 메인페이지 출력 클래스	// 작성자	: 김성호 (sh.kim@yourstage.com)	// 소속명	: Development Team	// 수정일	: 20090323#endregionif( !class_exists("MainPage") ){	global $gcls_ClassCollection;	$gcls_ClassCollection->LoadClassDefine( "/class/pages", "BBSPage" );	$gcls_ClassCollection->LoadClassDefine( "/class/data", "EZ_Contime", GDC_INC_ROOT );	$gcls_ClassCollection->LoadClassDefine( "/class/data", "EZ_Conrefer", GDC_INC_ROOT );	$gcls_ClassCollection->LoadClassDefine( "/class/data", "EZ_Content", GDC_INC_ROOT );	class MainPage extends BBSPage	{		var $cls_EZ_Contime		= null;		var $cls_EZ_Conrefer	= null;		var $cls_EZ_Content		= null;		//클래스 생성자		function MainPage()		{			$this->InitField();		}		#region 상속받은 메소드 보완			/**			* 데이터 초기화			*			*/			function InitField()			{				parent::InitField();				$this->cls_EZ_Contime = new EZ_Contime();				$this->cls_EZ_Conrefer = new EZ_Conrefer();				$this->cls_EZ_Content = new EZ_Content();			}			/**			* DBA 셋팅			*			* @param class		$acls_DBA				:	DBA 클래스			*/			function SetDBA( $acls_DBA )			{				parent::SetDBA( $acls_DBA );				$this->cls_EZ_Contime->SetDBA( $acls_DBA );				$this->cls_EZ_Conrefer->SetDBA( $acls_DBA );				$this->cls_EZ_Content->SetDBA( $acls_DBA );			}		#endregion		#region 방문로그 기록처리			/**			* 방문로그 기록처리			*			*/			function RegConnect()			{				if( !$this->GetCookie( "ez_connect", "", true ) )				{					$this->SetCookie( "ez_connect", "true", 0, '/', "heart-heart.org" );					// 접속시간 저장					$i_time = date('YmdH');					if( $this->cls_EZ_Contime->Load( "ez_contime", "(time='".$i_time."')" ) )					{						$this->cls_EZ_Contime->SetData( "ez_contime", 'cnt', "(cnt + 1)", "METHOD" );						$this->cls_EZ_Contime->Update( "ez_contime", "(time='".$i_time."')" );					}					else					{						$this->cls_EZ_Contime->SetData( "ez_contime", 'time', $i_time );						$this->cls_EZ_Contime->Insert( "ez_contime" );					}					// 접속레퍼러 저장					$i_referer = $this->SERVER['HTTP_REFERER'];					$i_parse_url = parse_url($i_referer);					$i_host = $i_parse_url['host'];					if( $this->cls_EZ_Conrefer->Load( "ez_conrefer", "(referer='".$i_referer."')" ) )					{						$this->cls_EZ_Conrefer->SetData( "ez_conrefer", 'cnt', "(cnt + 1)", "METHOD" );						$this->cls_EZ_Conrefer->Update( "ez_conrefer", "(referer='".$i_referer."')" );					}					else					{						$this->cls_EZ_Conrefer->SetData( "ez_conrefer", 'referer', $i_referer );						$this->cls_EZ_Conrefer->SetData( "ez_conrefer", 'host', $i_host );						$this->cls_EZ_Conrefer->Insert( "ez_conrefer" );					}				}			}		#endregion		#region EZ_Content 관련 메소드			/**			* GetSelectRecordsOfPopUp			*			* @return recordset			*/			function GetSelectRecordsOfPopUp()			{				$i_today = date('Y-m-d');				return $this->cls_EZ_Content->GetSelectRecords( "ez_content", "(type='popup') AND (isuse='Y') AND (sdate<='".$i_today."' and edate >= '".$i_today."')", "ORDER BY idx ASC" );			}			/**			* 레코드 루프적용			*			* @param recordset	$ars_Source				:	데이터 원본 레코드셋			* @param array		$arr_Fields				:	데이터 셋팅적용 필드배열			* @return boolean			*/			function LoopForPopUp( $ars_Source, $arr_Fields=null )			{				return $this->cls_EZ_Content->Loop( "ez_content", $ars_Source, $arr_Fields );			}		#endregion	}}?>